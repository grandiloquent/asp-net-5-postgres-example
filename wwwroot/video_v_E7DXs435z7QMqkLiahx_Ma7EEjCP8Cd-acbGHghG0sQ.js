function formatDuration(n){if(isNaN(n))return"0:00";n<0&&(n=-n);const t={hour:Math.floor(n/3600)%24,minute:Math.floor(n/60)%60,second:Math.floor(n)%60};return Object.entries(t).filter((n,t)=>t||n[1]).map(n=>(n[1]+"").padStart(2,"0")).join(":")}function calculateLoadedPercent(n){return n.buffered.length?n.buffered.end(0)/n.duration*100+"%":"0"}function calculateProgressPercent(n){return(n.currentTime/n.duration*100).toFixed(2)+"%"}function fuzzysearch(n,t){var r=t.length,u=n.length,i,f,e;if(u>r)return!1;if(u===r)return n===t;n:for(i=0,f=0;i<u;i++){for(e=n.charCodeAt(i);f<r;)if(t.charCodeAt(f++)===e)continue n;return!1}return!0}function writeText(n){const t=document.createElement("textarea");t.style.position="fixed";t.style.right="100%";document.body.appendChild(t);t.value=n;t.select();document.execCommand("copy");t.remove()}async function readText(){return await navigator.clipboard.readText()}function substringAfter(n,t,i){const r=n.indexOf(t);return r===-1?i||n:n.substring(r+t.length)}function substringAfterLast(n,t,i){const r=n.lastIndexOf(t);return r===-1?i||n:n.substring(r+t.length)}function substringBefore(n,t,i){const r=n.indexOf(t);return r===-1?i||n:n.substring(0,r)}function substringBeforeLast(n,t,i){const r=n.lastIndexOf(t);return r===-1?i||n:n.substring(0,r)}async function getStringAsync(n,t){const i=await fetch(n,{method:"GET",...t});if(!i.ok)throw new Error;return await i.text()}function makeOverlay(){const u=document.createElement("DIV");u.setAttribute("class","ytp-cued-thumbnail-overlay");const i=document.createElement("BUTTON");i.setAttribute("class","ytp-button");const n=document.createElementNS("http://www.w3.org/2000/svg","svg");n.setAttribute("height","100%");n.setAttribute("version","1.1");n.setAttribute("viewBox","0 0 68 48");n.setAttribute("width","100%");const t=document.createElementNS("http://www.w3.org/2000/svg","path");t.setAttribute("class","ytp-button-path");t.setAttribute("d","M66.52,7.74c-0.78-2.93-2.49-5.41-5.42-6.19C55.79,.13,34,0,34,0S12.21,.13,6.9,1.55 C3.97,2.33,2.27,4.81,1.48,7.74C0.06,13.05,0,24,0,24s0.06,10.95,1.48,16.26c0.78,2.93,2.49,5.41,5.42,6.19 C12.21,47.87,34,48,34,48s21.79-0.13,27.1-1.55c2.93-0.78,4.64-3.26,5.42-6.19C67.94,34.95,68,24,68,24S67.94,13.05,66.52,7.74z");t.setAttribute("fill","#f00");n.appendChild(t);const r=document.createElementNS("http://www.w3.org/2000/svg","path");r.setAttribute("d","M 45,24 27,14 27,34");r.setAttribute("fill","#fff");n.appendChild(r);i.appendChild(n);u.appendChild(i)}function start(n){const t=JSON.parse(n).videos;video.src=t[0];video.play()}async function applyVideos(){async function n(){const n=await fetch("http://47.106.105.122/api/video/random");if(!n.ok)throw new Error(n.statusText);return await n.json()}async function t(){async function r(){const n=await fetch("http://47.106.105.122/api/video/ck");if(!n.ok)throw new Error(n.statusText);return await n.text()}const i=new IntersectionObserver(n=>{n[0].isIntersecting&&(n[0].target.src=n[0].target.dataset.src,i.observe(n[0].target))});let t;try{t=await r()}catch(e){t=await r()}const f=await n(),u=document.createDocumentFragment();f.forEach(n=>{const r=document.createElement("DIV");r.setAttribute("data-id",n.id);r.setAttribute("data-href",n.url);r.setAttribute("class","ytm-large-media-item");const k=document.createElement("A"),e=document.createElement("DIV");e.setAttribute("class","video-thumbnail-container-large");const d=document.createElement("DIV");d.setAttribute("class","video-thumbnail-bg");e.appendChild(d);const o=document.createElement("IMG");o.setAttribute("class","ytm-video-with-context-renderer");o.setAttribute("data-src",n.thumbnail);i.observe(o);e.appendChild(o);const c=document.createElement("DIV");c.setAttribute("class","video-thumbnail-overlay-bottom-group");const l=document.createElement("DIV");l.setAttribute("class","ytm-thumbnail-overlay-time-status-renderer");l.appendChild(document.createTextNode(formatDuration(n.duration)));c.appendChild(l);e.appendChild(c);k.appendChild(e);r.appendChild(k);const s=document.createElement("DIV");s.setAttribute("class","details");const a=document.createElement("DIV");a.setAttribute("class","large-media-channel");const v=document.createElement("DIV");v.setAttribute("class","ytm-channel-thumbnail-with-link-renderer");const y=document.createElement("DIV");y.setAttribute("class","channel-thumbnail-icon");y.appendChild(document.createTextNode(n.type===3?"57":n.type===1?"91":"XV"));v.appendChild(y);a.appendChild(v);s.appendChild(a);const h=document.createElement("DIV");h.setAttribute("class","large-media-item-info");const p=document.createElement("DIV");p.setAttribute("class","large-media-item-metadata");const g=document.createElement("H3");g.appendChild(document.createTextNode(n.title));p.appendChild(g);h.appendChild(p);const w=document.createElement("DIV");w.setAttribute("class","large-media-item-menu");const b=document.createElement("BUTTON");b.setAttribute("class","icon-button");const nt=document.createElement("C3-ICON"),f=document.createElementNS("http://www.w3.org/2000/svg","svg");f.setAttribute("xmlns","http://www.w3.org/2000/svg");f.setAttribute("enable-background","new 0 0 24 24");f.setAttribute("height","24");f.setAttribute("viewBox","0 0 24 24");f.setAttribute("width","24");const tt=document.createElementNS("http://www.w3.org/2000/svg","path");tt.setAttribute("d","M12,16.5c0.83,0,1.5,0.67,1.5,1.5s-0.67,1.5-1.5,1.5s-1.5-0.67-1.5-1.5S11.17,16.5,12,16.5z M10.5,12 c0,0.83,0.67,1.5,1.5,1.5s1.5-0.67,1.5-1.5s-0.67-1.5-1.5-1.5S10.5,11.17,10.5,12z M10.5,6c0,0.83,0.67,1.5,1.5,1.5 s1.5-0.67,1.5-1.5S12.83,4.5,12,4.5S10.5,5.17,10.5,6z");f.appendChild(tt);nt.appendChild(f);b.appendChild(nt);w.appendChild(b);h.appendChild(w);s.appendChild(h);r.appendChild(s);r.addEventListener("click",()=>{const n=r.getAttribute("data-href"),i=r.getAttribute("data-id");fetch(`http://47.106.105.122/api/video/record?id=${i}`).then(n=>n.text()).then(n=>{console.log(n)});n.startsWith("http://")||n.startsWith("https://")?window.JInterface.parse(n):window.JInterface.parse(t+n)});u.appendChild(r)});contextRenderer.appendChild(u)}new IntersectionObserver(n=>{n[0].isIntersecting&&(n[0].target.src=n[0].target.dataset.src)});await t()}class CustomToast extends HTMLElement{static get observedAttributes(){return["message"]}constructor(){super();this.root=this.attachShadow({mode:"open"});const r=document.createElement("style");r.textContent=CustomToast.getStyle();this.root.appendChild(r);const n=document.createElement("DIV");n.setAttribute("class","c3-toast");const t=document.createElement("DIV");t.setAttribute("class","notification-action-renderer");const i=document.createElement("DIV");i.setAttribute("class","notification-action-response-text");t.appendChild(i);n.appendChild(t);this.root.appendChild(n);this.c3Toast=n;this.notificationActionResponseText=i;this.messages=[];this.timer=0}connectedCallback(){}disconnectedCallback(){}showMessage(){if(this.messages.length&&!this.showing){const n=this.messages.shift();this.notificationActionResponseText.textContent=n;this.c3Toast.setAttribute("dir","in");this.showing=!0;this.timer&&clearTimeout(this.timer);this.timer=setTimeout(()=>{this.c3Toast.setAttribute("dir","out"),setTimeout(()=>{this.showing=!1,this.showMessage()},195)},3e3)}}attributeChangedCallback(n,t,i){n==="message"&&(this.messages.push(i),this.showMessage())}adoptedCallback(){}static getTemplate(n){return`
        ${CustomToast.getStyle()}
        <div>
            ${n}
        </div>
        `}static getStyle(){return`
        .c3-toast[dir="in"] {
            transition: margin 225ms cubic-bezier(0.0, 0.0, 0.2, 1);
            margin-bottom: 0;
        }
        
        .c3-toast[dir="out"] {
            transition: margin 195ms cubic-bezier(0.4, 0.0, 1, 1);
        }
        
        .c3-toast {
            display: block;
            position: fixed;
            z-index: 4;
            left: 0;
            right: 0;
            bottom: 0;
            box-sizing: border-box;
            padding: 14px 24px;
            font-size: 1.4rem;
            color: #ffffff;
            background: hsl(0, 0%, 20%);
            will-change: transform;
            margin-bottom: -100%;
        }
        
        .notification-action-renderer {
            display: flex;
            align-items: center;
        }
        
        .notification-action-response-text {
            flex-grow: 1;
            padding-right: 1rem;
            font-size:14px;
        }
        
        `}}customElements.define("custom-toast",CustomToast);const timeFirst=document.querySelector(".time-first"),timeSecond=document.querySelector(".time-second"),progressBarPlayed=document.querySelector(".progress-bar-played"),progressBarLoaded=document.querySelector(".progress-bar-loaded"),progressBarPlayheadWrapper=document.querySelector(".progress-bar-playhead-wrapper"),centerWrapper=document.querySelector(".center-wrapper"),video=document.querySelector(".html5-main-video");video.volume=0;video.addEventListener("timeupdate",()=>{timeFirst.textContent=formatDuration(video.currentTime);const n=calculateProgressPercent(video);progressBarPlayed.style.width=n;progressBarPlayheadWrapper.style.marginLeft=n});video.addEventListener("progress",()=>{progressBarLoaded.style.width=calculateLoadedPercent(video)});video.addEventListener("error",()=>{console.log("error"),centerWrapper.style.display="none"});video.addEventListener("play",()=>{console.log("play"),centerWrapper.style.display="none"});video.addEventListener("durationchange",()=>{console.log("durationchange"),timeSecond.textContent=formatDuration(video.duration)});const ytpAutohide=document.querySelector(".ytp-autohide");ytpAutohide.addEventListener("click",()=>{video.volume=1,ytpAutohide.style.display="none"});let playing=!1,timer=0;const player=document.querySelector("#player");player.addEventListener("click",()=>{playing&&(playerControlOverlay.style.display="block",playerControlOverlay.className=playerControlOverlay.className+" fadein",timer=setTimeout(()=>{playerControlOverlay.style.display="none"},5e3))});const playerControlOverlay=document.querySelector(".player-control-overlay"),playerControlPlayPauseIcon=document.querySelector(".player-control-play-pause-icon");playerControlPlayPauseIcon.addEventListener("click",n=>{n.stopPropagation(),video.paused?(video.play(),timer=setTimeout(()=>{playerControlOverlay.style.display="none"},5e3),playerControlPlayPauseIcon.querySelector("svg").innerHTML=`<path d="M9,19H7V5H9ZM17,5H15V19h2Z"></path>`):(video.pause(),clearTimeout(timer),playing=!1,playerControlPlayPauseIcon.querySelector("svg").innerHTML=`<g>
                                        <path d="M6,4l12,8L6,20V4z"></path>
                                    </g>`)});const iconButton=document.querySelector(".full-screen");iconButton.addEventListener("click",async n=>{n.stopPropagation();try{await video.requestFullscreen();screen.orientation.lock&&screen.orientation.lock("landscape")}catch(t){}});video.addEventListener("abort",()=>{console.log("abort")});video.addEventListener("canplay",()=>{console.log("canplay")});video.addEventListener("canplaythrough",()=>{console.log("canplaythrough")});video.addEventListener("emptied",()=>{console.log("emptied")});video.addEventListener("ended",()=>{console.log("ended")});video.addEventListener("loadeddata",()=>{console.log("loadeddata")});video.addEventListener("loadedmetadata",()=>{console.log("loadedmetadata")});video.addEventListener("loadstart",()=>{console.log("loadstart")});video.addEventListener("pause",()=>{console.log("pause")});video.addEventListener("playing",()=>{playing=!0,console.log("playing")});video.addEventListener("ratechange",()=>{console.log("ratechange")});video.addEventListener("seeked ",()=>{console.log("seeked ")});video.addEventListener("seeking",()=>{console.log("seeking")});video.addEventListener("stalled",()=>{console.log("stalled")});video.addEventListener("suspend",()=>{console.log("suspend")});video.addEventListener("volumechange",()=>{console.log("volumechange")});video.addEventListener("waiting",()=>{console.log("waiting")});const contextRenderer=document.querySelector(".context-renderer");applyVideos()