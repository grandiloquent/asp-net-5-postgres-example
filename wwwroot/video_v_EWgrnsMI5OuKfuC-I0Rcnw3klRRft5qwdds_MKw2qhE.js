function formatDuration(n){if(isNaN(n))return"0:00";n<0&&(n=-n);const t={hour:Math.floor(n/3600)%24,minute:Math.floor(n/60)%60,second:Math.floor(n)%60};return Object.entries(t).filter((n,t)=>t||n[1]).map(n=>(n[1]+"").padStart(2,"0")).join(":")}function calculateLoadedPercent(n){return n.buffered.length?n.buffered.end(0)/n.duration*100+"%":"0"}function calculateProgressPercent(n){return(n.currentTime/n.duration*100).toFixed(2)+"%"}function start(n){const t=JSON.parse(n).videos;video.src=t[0];video.play()}async function applyVideos(){async function n(){const n=await fetch("http://47.106.105.122/api/video/random");if(!n.ok)throw new Error(n.statusText);return await n.json()}async function t(){async function u(){const n=await fetch("http://47.106.105.122/api/video/57ck");if(!n.ok)throw new Error(n.statusText);return await n.text()}const t=new IntersectionObserver(n=>{n[0].isIntersecting&&(n[0].target.src=n[0].target.dataset.src,t.observe(n[0].target))});let i=await u();console.log(i);const f=await n(),r=document.createDocumentFragment();f.forEach(n=>{const u=document.createElement("DIV");u.setAttribute("data-id",n.id);u.setAttribute("data-href",n.url);u.setAttribute("class","ytm-large-media-item");const k=document.createElement("A"),e=document.createElement("DIV");e.setAttribute("class","video-thumbnail-container-large");const d=document.createElement("DIV");d.setAttribute("class","video-thumbnail-bg");e.appendChild(d);const o=document.createElement("IMG");o.setAttribute("class","ytm-video-with-context-renderer");o.setAttribute("data-src",n.thumbnail);t.observe(o);e.appendChild(o);const c=document.createElement("DIV");c.setAttribute("class","video-thumbnail-overlay-bottom-group");const l=document.createElement("DIV");l.setAttribute("class","ytm-thumbnail-overlay-time-status-renderer");l.appendChild(document.createTextNode(formatDuration(n.duration)));c.appendChild(l);e.appendChild(c);k.appendChild(e);u.appendChild(k);const s=document.createElement("DIV");s.setAttribute("class","details");const a=document.createElement("DIV");a.setAttribute("class","large-media-channel");const v=document.createElement("DIV");v.setAttribute("class","ytm-channel-thumbnail-with-link-renderer");const y=document.createElement("DIV");y.setAttribute("class","channel-thumbnail-icon");y.appendChild(document.createTextNode(n.type===3?"57":n.type===1?"91":"XV"));v.appendChild(y);a.appendChild(v);s.appendChild(a);const h=document.createElement("DIV");h.setAttribute("class","large-media-item-info");const p=document.createElement("DIV");p.setAttribute("class","large-media-item-metadata");const g=document.createElement("H3");g.appendChild(document.createTextNode(n.title));p.appendChild(g);h.appendChild(p);const w=document.createElement("DIV");w.setAttribute("class","large-media-item-menu");const b=document.createElement("BUTTON");b.setAttribute("class","icon-button");const nt=document.createElement("C3-ICON"),f=document.createElementNS("http://www.w3.org/2000/svg","svg");f.setAttribute("xmlns","http://www.w3.org/2000/svg");f.setAttribute("enable-background","new 0 0 24 24");f.setAttribute("height","24");f.setAttribute("viewBox","0 0 24 24");f.setAttribute("width","24");const tt=document.createElementNS("http://www.w3.org/2000/svg","path");tt.setAttribute("d","M12,16.5c0.83,0,1.5,0.67,1.5,1.5s-0.67,1.5-1.5,1.5s-1.5-0.67-1.5-1.5S11.17,16.5,12,16.5z M10.5,12 c0,0.83,0.67,1.5,1.5,1.5s1.5-0.67,1.5-1.5s-0.67-1.5-1.5-1.5S10.5,11.17,10.5,12z M10.5,6c0,0.83,0.67,1.5,1.5,1.5 s1.5-0.67,1.5-1.5S12.83,4.5,12,4.5S10.5,5.17,10.5,6z");f.appendChild(tt);nt.appendChild(f);b.appendChild(nt);w.appendChild(b);h.appendChild(w);s.appendChild(h);u.appendChild(s);u.addEventListener("click",()=>{const n=u.getAttribute("data-href"),t=u.getAttribute("data-id");fetch(`http://47.106.105.122/api/video/record?id=${t}`).then(n=>n.text()).then(n=>{console.log(n)});n.startsWith("http://")||n.startsWith("https://")?window.JInterface.parse(n):window.JInterface.parse(i+n)});r.appendChild(u)});contextRenderer.appendChild(r)}new IntersectionObserver(n=>{n[0].isIntersecting&&(n[0].target.src=n[0].target.dataset.src)});await t()}const timeFirst=document.querySelector(".time-first"),timeSecond=document.querySelector(".time-second"),progressBarPlayed=document.querySelector(".progress-bar-played"),progressBarLoaded=document.querySelector(".progress-bar-loaded"),progressBarPlayheadWrapper=document.querySelector(".progress-bar-playhead-wrapper"),video=document.querySelector(".html5-main-video");video.volume=0;const ytpButton=document.querySelector(".ytp-button");ytpButton.addEventListener("click",n=>{n.stopPropagation(),video.play(),ytpButton.style.display="none"});const ytpAutohide=document.querySelector(".ytp-autohide");ytpAutohide.addEventListener("click",()=>{video.volume=1,ytpAutohide.style.display="none"});let playing=!1,timer=0;const player=document.querySelector("#player");player.addEventListener("click",()=>{playing&&(playerControlOverlay.style.display="block",playerControlOverlay.className=playerControlOverlay.className+" fadein",timer=setTimeout(()=>{playerControlOverlay.style.display="none"},5e3))});const playerControlOverlay=document.querySelector(".player-control-overlay");playerControlOverlay.addEventListener("click",()=>{});const playerControlPlayPauseIcon=document.querySelector(".player-control-play-pause-icon");playerControlPlayPauseIcon.addEventListener("click",n=>{n.stopPropagation(),video.paused?(video.play(),timer=setTimeout(()=>{playerControlOverlay.style.display="none"},5e3),playerControlPlayPauseIcon.querySelector("svg").innerHTML=`<path d="M9,19H7V5H9ZM17,5H15V19h2Z"></path>`):(video.pause(),clearTimeout(timer),playing=!1,playerControlPlayPauseIcon.querySelector("svg").innerHTML=`<g>
                                        <path d="M6,4l12,8L6,20V4z"></path>
                                    </g>`)});const iconButton=document.querySelector(".full-screen");iconButton.addEventListener("click",async n=>{n.stopPropagation();try{await video.requestFullscreen();screen.orientation.lock&&screen.orientation.lock("landscape")}catch(t){}});video.addEventListener("abort",()=>{console.log("abort")});video.addEventListener("canplay",()=>{console.log("canplay")});video.addEventListener("canplaythrough",()=>{console.log("canplaythrough")});video.addEventListener("durationchange",()=>{console.log("durationchange"),timeSecond.textContent=formatDuration(video.duration)});video.addEventListener("emptied",()=>{console.log("emptied")});video.addEventListener("ended",()=>{console.log("ended")});video.addEventListener("error",()=>{console.log("error")});video.addEventListener("loadeddata",()=>{console.log("loadeddata")});video.addEventListener("loadedmetadata",()=>{console.log("loadedmetadata")});video.addEventListener("loadstart",()=>{console.log("loadstart")});video.addEventListener("pause",()=>{console.log("pause")});video.addEventListener("play",()=>{ytpButton.style.display="none",console.log("play")});video.addEventListener("playing",()=>{playing=!0,console.log("playing")});video.addEventListener("progress",()=>{console.log("progress"),progressBarLoaded.style.width=calculateLoadedPercent(video)});video.addEventListener("ratechange",()=>{console.log("ratechange")});video.addEventListener("seeked ",()=>{console.log("seeked ")});video.addEventListener("seeking",()=>{console.log("seeking")});video.addEventListener("stalled",()=>{console.log("stalled")});video.addEventListener("suspend",()=>{console.log("suspend")});video.addEventListener("timeupdate",()=>{timeFirst.textContent=formatDuration(video.currentTime);const n=calculateProgressPercent(video);progressBarPlayed.style.width=n;progressBarPlayheadWrapper.style.marginLeft=n});video.addEventListener("volumechange",()=>{console.log("volumechange")});video.addEventListener("waiting",()=>{console.log("waiting")});const contextRenderer=document.querySelector(".context-renderer");applyVideos()